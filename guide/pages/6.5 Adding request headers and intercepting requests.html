<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>6.5 Adding request headers and intercepting requests</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    Resource mappers also have the opportunity to take part in response handling so that they can adjust the response headers if necessary. You may need to adapt the handling of the current request to the request headers supplied.<p class="paragraph"/>Note that this cannot be used to change how the resource is mapped - the mapping is performed once only, but the response headers can be customized  every time the file is requested.<p class="paragraph"/>As an example, the Zipped-Resources plugin uses this mechanism to set the Content-Encoding header:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.grails.plugin.resource.mapper.MapperPhase<p class="paragraph"/>class ZipResourceMapper &#123;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> phase = MapperPhase.ALTERNATEREPRESENTATION<p class="paragraph"/>    /&#42;&#42;
     &#42; Rename the file to a hash of it's contents, and set caching headers 
     &#42;/
    def map(resource, config) &#123;
        // Do the zipping
        ...<p class="paragraph"/>        // Set up response headers
        resource.requestProcessors &#60;&#60; &#123; req, resp &#45;&#62;
            resp.setHeader('Content&#45;Encoding', 'gzip')
        &#125;    
    &#125;
&#125;</pre></div><p class="paragraph"/>Here the mapper adds a Closure that takes the request and response objects to the resource's requestProcessors list. These will be called in the order they are defined on the resource.<p class="paragraph"/>
    </body>
</html>
