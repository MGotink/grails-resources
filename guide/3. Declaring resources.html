<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>3. Declaring resources</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    <h1><a name="3. Declaring resources">3. Declaring resources</a></h1>You can declare your resources in your Application's Config.groovy or in a Resources artefact in your application or plugins.<p class="paragraph"/>This is done using a simple DSL in both cases. You define the names of the modules you have and the resources within them, and dependencies between modules.<p class="paragraph"/><h2><a name="3.1 The resource DSL">3.1 The resource DSL</a></h2>There are few methods to call in the DSL. At the top level method calls taking a single Closure argument are translated into module names. The code in the nested closure represents the module definition.<p class="paragraph"/>A module definition can call dependsOn, defaultBundle and resource methods:<p class="paragraph"/><div class="code"><pre>modules = &#123;
    core &#123;
        dependsOn 'jquery, utils'
        defaultBundle 'ui'<p class="paragraph"/>        resource url:'/js/core.js', disposition: 'head'
        resource url:'/js/ui.js'
        resource url:'/css/main.css', 
        resource url:'/css/branding.css'
        resource url:'/css/print.css', attrs:&#91;media:'print'&#93;
    &#125;<p class="paragraph"/>    utils &#123;
        dependsOn 'jquery'<p class="paragraph"/>        resource url:'/js/utils.js' 
    &#125;<p class="paragraph"/>    forms &#123;
        dependsOn 'core,utils'
        defaultBundle 'ui'<p class="paragraph"/>        resource url:'/css/forms.css'
        resource url:'/js/forms.js'
    &#125;
&#125;</pre></div><p class="paragraph"/>The above DSL defines three resource modules; 'core', 'utils' and 'forms'. The resources in these modules will be automatically bundled out of the box according to the module name, resulting in fewer files. You can override this with <strong class="bold">bundle:'someOtherName'</strong> on each resource, or call defaultBundle on the module
<h2><a name="3.1.1 The dependsOn method">3.1.1 The dependsOn method</a></h2>To declare that a module depends on another, you use dependsOn. It accepts a string or list of names. The string can be comma-delimited to specify multiple dependencies. You can also call dependsOn as many times as you like:<p class="paragraph"/><div class="code"><pre>modules = &#123;
    core &#123;
        dependsOn 'jquery, utils'
        dependsOn 'other'
        dependsOn(&#91;'heavy', 'metal'&#93;)
    &#125;
&#125;</pre></div>
<h2><a name="3.1.2 The resource method">3.1.2 The resource method</a></h2>
Declaring a resource is done using the "resource" method. This takes either a single string URI or a map of arguments that define the URL of the resource and any other specific options you require.<p class="paragraph"/>The single-string argument variant is a simple shortcut for resources that are safe to use all defaults:<p class="paragraph"/><div class="code"><pre>modules = &#123;
    ui &#123;
        resource '/css/forms.css'
        resource '/js/forms.js'
    &#125;
&#125;</pre></div><p class="paragraph"/>The more powerful map argument form accepts the following arguments:
<ul class="star">
<li>url - Required. The app-relative URL of the resource as a String, or a g:resource-style map of dir, file and plugin attributes.</li>
<li>exclude - Optional. A comma-delimited String or a List of names of mappers/operations to exclude. The special "*" value excludes all mappers and operations - the resource will be passed-through as is. You can exclude specific operations such as "minify" if the resource has already been minified.</li>
<li>bundle - Optional. The name of the bundle to put the resource into. See "Bundling" for more details</li>
<li>disposition - Optional. The disposition of the resource. If not specified, it will default to a value appropriate for the type of the resource. For JavaScript this default is "defer". To force code into the &#60;head&#62;, set it to "head".</li>
<li>attrs - Optional. Map of attribute names and values to pass through to the linking tag when the resource is rendered. e.g. use to pass attrs:media:'print' for print-only CSS, or "type". Note that supplying "attrs" will prevent bundling of the resource. Passing in "type" (which is passed through to <a href="../ref/Tags/external.html" class="Tags">external</a> tag) allows you to tell the framework that the resource is a specific type irrespective of the file extension. For example if you have a file that ends ".less" but you want the framework to treat it like CSS when rendering links, you need to set attrs:&#91;type:"css"&#93;.</li>
<li>id - Optional. Module-unique id of the resource to be used when <a href="../guide/single.html#5. Overriding resources" class="guide">overriding</a> resource properties. Defaults to the url of the resource if none supplied.</li>
<li>linkOverride - Optional. The URL to use when rendering links for the resource, instead of the processed resource's URL. Allows your external resources to participate in dependency management, and some niche CDN requirements.</li>
<li>wrapper - Optional. A Closure that will be used to render the resource link. The correct markup for linking will be passed in. Used primarily for MSIE workarounds i.e: wrapper: &#123; s -&#62; "&#60;!--if lt IE 8&#62;$s&#60;!endif--&#62;" &#125;. Note that supplying a wrapper will prevent bundling of that resource.</li>
</ul><p class="paragraph"/>Examples:<p class="paragraph"/><div class="code"><pre>modules = &#123;
    core &#123;
        resource url:&#91;dir:'css/blueprint',file:'screen.css'&#93;, attrs:&#91;media:'screen, projection'&#93;, bundle:'core&#45;ui'
        resource url:&#91;dir:'css/blueprint',file:'ie.css'&#93;, attrs:&#91;media:'screen, projection'&#93;,  
            wrapper: &#123; s &#45;&#62; <span class="java&#45;quote">"&#60;!&#45;&#45;&#91;<span class="java&#45;keyword">if</span> lt IE 8&#93;&#62;$s&#60;!&#91;endif&#93;&#45;&#45;&#62;"</span> &#125;<p class="paragraph"/>        resource id:'main&#45;js', url:'js/coreutils&#45;min.js', disposition: 'head', exclude:'minify'<p class="paragraph"/>        resource url:'js/lib.js', linkOverride:'http://mycdn.com/js/lib.js'
    &#125;<p class="paragraph"/>    ui &#123;
        resource url:'/css/forms.css', bundle:'core&#45;ui'
        resource url:'/js/forms.js'
    &#125;
&#125;</pre></div>
<h2><a name="3.1.3 The defaultBundle method">3.1.3 The defaultBundle method</a></h2>By default, modules with more than one resource will be auto-bundled using the module name as a bundle name. You can override this by setting the default bundle name for the module by calling defaultBundle. This name can be the same as bundles used in other modules, to bundle resoures across module boundaries.<p class="paragraph"/>The method takes a String or boolean as parameter. A string sets the default bundle name, and passing in a boolean false will turn off all default bundling for that module.<p class="paragraph"/><div class="code"><pre>modules = &#123;
    core &#123;
        defaultBundle 'core&#45;ui'<p class="paragraph"/>        resource url:&#91;dir:'css/blueprint',file:'screen.css'&#93;, attrs:&#91;media:'screen, projection'&#93;
        resource url:&#91;dir:'css/blueprint',file:'ie.css'&#93;, attrs:&#91;media:'screen, projection'&#93;,  
            wrapper: &#123; s &#45;&#62; <span class="java&#45;quote">"&#60;!&#45;&#45;&#91;<span class="java&#45;keyword">if</span> lt IE 8&#93;&#62;$s&#60;!&#91;endif&#93;&#45;&#45;&#62;"</span> &#125;<p class="paragraph"/>        resource id:'main&#45;js', url:'js/coreutils&#45;min.js', disposition: 'head', exclude:'minify'<p class="paragraph"/>        resource url:'js/lib.js', linkOverride:'http://mycdn.com/js/lib.js'
    &#125;<p class="paragraph"/>    ui &#123;
        defaultBundle 'core&#45;ui'<p class="paragraph"/>        resource url:'/css/forms.css', bundle:'theme'
        resource url:'/js/forms.js'
    &#125;
&#125;</pre></div><p class="paragraph"/>Here you can see that the fallback bundle for both modules is set to "core-ui" and individual resources can still override this.
<h2><a name="3.2 Resource artefacts">3.2 Resource artefacts</a></h2>The best place to put these declarations is in a resource artefact. These have a filename ending in Resources.groovy and live in grails-app/conf.<p class="paragraph"/>Note that these are Groovy ConfigSlurper scripts that are therefore environment-aware, so you can declare different resources for e.g. dev, test and production.<p class="paragraph"/>Example grails-app/conf/MyAppResources.groovy:<p class="paragraph"/><div class="code"><pre>modules = &#123;
    core &#123;
        dependsOn 'jquery, utils'
        defaultBundle 'ui'<p class="paragraph"/>        resource url:'/js/core.js', disposition: 'head'
        resource url:'/js/ui.js'
    &#125;<p class="paragraph"/>    utils &#123;
        dependsOn 'jquery'<p class="paragraph"/>        resource url:'/js/utils.js' 
    &#125;<p class="paragraph"/>    forms &#123;
        dependsOn 'core,utils'
        defaultBundle 'ui'<p class="paragraph"/>        resource url:'/css/forms.css'
        resource url:'/js/forms.js'
    &#125;
&#125;</pre></div>
<h2><a name="3.3 Config.groovy">3.3 Config.groovy</a></h2>Applications can also define resources in Config.groovy if they wish. Simply assign the DSL to the <strong class="bold">grails.resources.modules</strong> property.<p class="paragraph"/>Example in grails-app/conf/Config.groovy:<p class="paragraph"/><div class="code"><pre>grails.resources.modules = &#123;
    core &#123;
        dependsOn 'jquery, utils'
        defaultBundle 'ui'<p class="paragraph"/>        resource url:'/js/core.js', disposition: 'head'
        resource url:'/js/ui.js'
    &#125;<p class="paragraph"/>    utils &#123;
        dependsOn 'jquery'<p class="paragraph"/>        resource url:'/js/utils.js' 
    &#125;<p class="paragraph"/>    forms &#123;
        dependsOn 'core,utils'
        defaultBundle 'ui'<p class="paragraph"/>        resource url:'/css/forms.css'
        resource url:'/js/forms.js'
    &#125;
&#125;</pre></div><p class="paragraph"/><h2><a name="3.4 Bundling">3.4 Bundling</a></h2>As mentioned earlier, bundling can be controlled in a number of ways. The logic runs as follows:
<ol>
<li>If a resource has an explicit bundle property set, this is used.</li>
<li>If there is no explicit bundle property set on the resource, it will use the default for the module</li>
<li>The default for the module is "bundle_" plus the name of the module unless defaultBundle has been called</li>
<li>If defaultBundle has been called in the module with a string, that name is used for the resource's bundle</li>
<li>If defaultBundle has been called in the module with a boolean false, no bundling will occur on the resource, only resources with a bundle specified will be bundled.</li>
</ol><p class="paragraph"/><strong class="bold">NOTE</strong> If a resource declares "attrs" or "wrapper" it will not be bundled at all. This is because bundling does not make sense in this situation unless all the attrs and wrapper logic match.

    </body>
</html>
